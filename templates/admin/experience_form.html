{% extends "admin/base.html" %}

{% block title %}{{ 'Edit' if experience else 'Add' }} Experience - Admin{% endblock %}

{% block content %}
<div class="admin-header">
    <h1>
        <i class="fas fa-briefcase"></i>
        {{ 'Edit Experience' if experience else 'Add New Experience' }}
    </h1>
    <p>{{ 'Update the experience details' if experience else 'Add a new professional experience entry' }}</p>
</div>

<div class="admin-content">
    <form method="POST" class="admin-form">
        <div class="form-section">
            <h2>Basic Information</h2>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="job_title">Job Title *</label>
                    <input type="text" id="job_title" name="job_title" 
                           value="{{ experience.job_title if experience else '' }}" required>
                </div>
                
                <div class="form-group">
                    <label for="company">Company *</label>
                    <input type="text" id="company" name="company" 
                           value="{{ experience.company if experience else '' }}" required>
                </div>
            </div>
            
            <div class="form-group">
                <label for="location">Location</label>
                <input type="text" id="location" name="location" 
                       value="{{ experience.location if experience else '' }}">
            </div>
        </div>
        
        <div class="form-section">
            <h2>Employment Period</h2>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="start_date">Start Date *</label>
                    <input type="text" id="start_date" name="start_date" 
                           value="{{ experience.start_date if experience else '' }}" 
                           placeholder="e.g., January 2023 or 2023" required>
                </div>
                
                <div class="form-group">
                    <label for="end_date">End Date</label>
                    <input type="text" id="end_date" name="end_date" 
                           value="{{ experience.end_date if experience else '' }}" 
                           placeholder="e.g., December 2023 or 2023">
                </div>
            </div>
            
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" name="is_current" 
                           {{ 'checked' if experience and experience.is_current else '' }}>
                    <span class="checkmark"></span>
                    This is my current position
                </label>
            </div>
        </div>
        
        <div class="form-section">
            <h2>Description</h2>
            
            <div class="form-group">
                <label for="description">Job Description</label>
                <textarea id="description" name="description" rows="3" 
                          placeholder="Brief description of your role">{{ experience.description if experience else '' }}</textarea>
            </div>
        </div>
        
        <div class="form-section">
            <h2>Key Responsibilities</h2>
            
            <div class="dynamic-list" id="responsibilities-list">
                {% if experience and experience.responsibilities %}
                    {% for responsibility in experience.responsibilities|from_json %}
                    <div class="list-item">
                        <input type="text" name="responsibilities[]" value="{{ responsibility }}" 
                               placeholder="Enter a key responsibility">
                        <button type="button" class="btn btn-sm btn-danger remove-item">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="list-item">
                        <input type="text" name="responsibilities[]" placeholder="Enter a key responsibility">
                        <button type="button" class="btn btn-sm btn-danger remove-item">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                {% endif %}
            </div>
            
            <button type="button" class="btn btn-secondary add-item" data-target="responsibilities-list">
                <i class="fas fa-plus"></i>
                Add Responsibility
            </button>
        </div>
        
        <div class="form-section">
            <h2>Display Settings</h2>
            
            <div class="form-group">
                <label for="order_index">Display Order</label>
                <input type="number" id="order_index" name="order_index" 
                       value="{{ experience.order_index if experience else 0 }}" 
                       min="0" placeholder="0">
                <small>Lower numbers appear first</small>
            </div>
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-save"></i>
                {{ 'Update Experience' if experience else 'Add Experience' }}
            </button>
            <a href="{{ url_for('admin_experiences') }}" class="btn btn-secondary">
                <i class="fas fa-times"></i>
                Cancel
            </a>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Handle dynamic list items
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('add-item') || e.target.closest('.add-item')) {
            const button = e.target.classList.contains('add-item') ? e.target : e.target.closest('.add-item');
            const targetId = button.getAttribute('data-target');
            const container = document.getElementById(targetId);
            
            const newItem = document.createElement('div');
            newItem.className = 'list-item';
            newItem.innerHTML = `
                <input type="text" name="responsibilities[]" placeholder="Enter a key responsibility">
                <button type="button" class="btn btn-sm btn-danger remove-item">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            container.appendChild(newItem);
        }
        
        if (e.target.classList.contains('remove-item') || e.target.closest('.remove-item')) {
            const button = e.target.classList.contains('remove-item') ? e.target : e.target.closest('.remove-item');
            const container = button.closest('.dynamic-list');
            
            if (container.children.length > 1) {
                button.closest('.list-item').remove();
            }
        }
    });
});
</script>
{% endblock %}